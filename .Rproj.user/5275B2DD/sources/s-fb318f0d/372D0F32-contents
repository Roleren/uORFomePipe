#' Main function to fill uORF database
#' @export
createCatalogueDB <- function(df.cage, df.rna, df.rfp,
                              dataBaseFolder, idFolder, dataFolder,
                              leadersFolder, organism = "Homo sapiens",
                              biomart = "hsapiens_gene_ensembl") {
  uORFomePipe:::createDataBase(p(dataBaseFolder, "/uorfCatalogue.sqlite"))
  uORFomePipe:::createUniqueIDs(idFolder) # IDs for uORFs
  uORFomePipe:::createGRObjects(dataFolder, leadersFolder) # GRanges objects for all uORFs
  uORFomePipe:::createUORFAtlas(idFolder, dataFolder) # Per CAGE reassigned tx annotation, does uORF exist ?
  uORFomePipe:::getTissueTable(df.cage, dataFolder)  # Per CAGE tissue, does uORF exist ?
  allFeaturesAtlas(df.rfp, df.rna, organism, biomart) # Ribo-seq and RNA-seq features
}

#' all features of Riboseq and RNAseq
allFeaturesAtlas <- function(df.rfp, df.rna, organism, biomart){
  # TODO: Move to general validation
  #validateRiboRNAPairs()

  # first sequence features
  getSequenceFeatures(organism, biomart)

  # then computeFeatures
  getGeneralRiboFeatures(df.rfp, grl = uORFomePipe:::getUorfsInDb())
  # then rfpTables
  atlasTissue(df.rfp)
  # then rna tables
  getRNAFpkms()
  atlasTissue(df.rna, readTable("RNAfpkm"),
              dbOutputNames = c("RNAByTissueTF", "RNAByTissueMean"))
  # then do te tables
  getTeFeatures()
  teAtlasTissue()

  #cds and 3'
  getCDSFeatures()
  getFeaturesThreeUTRs()
}
